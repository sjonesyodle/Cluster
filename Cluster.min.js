Object.create=Object.create?Object.create:function(){var e=function(){};return function(f){e.prototype=f;return new e}}();Object.extend=Object.extend?Object.extend:function(){var e;return function(f,g){for(e in g)f[e]=g[e];return f}}(); (function(e){var f,g,h={Pub:function(a,c){var d=this;if(!this.topics[a])return!1;setTimeout(function(){for(var b=d.topics[a],e=b?b.length:0;e--;)b[e].func.apply(b[e].funcContext,[c])},0);return!0},Sub:function(a,c,d){var b;this.topics[a]||(this.topics[a]=[]);b=(++this.subUid).toString();this.topics[a].push({token:b,func:c,funcContext:d});return b},unSub:function(a){var c,d,b;for(c in this.topics)if(this.topics[c]){d=0;for(b=this.topics[c].length;d<b;d++)if(this.topics[c][d].token===a)return this.topics[c].splice(d, 1),console.log(this.topics[c]),a}return!1}};g=function(){var a=Object.create(h);a.subUid=-1;a.topics={};return a};var j={_destroy:function(){delete this._context.mods[this.uid]},_pubsub:function(){var a=this,c=a._context._PubSub,d=Array.prototype.slice;return{_pub:function(){var b=d.call(arguments);b.push(a);return c.Pub.apply(c,b)},_sub:function(){var b=d.call(arguments);b.push(a);return c.Sub.apply(c,b)},_unsub:function(){var a=d.call(arguments);return c.unSub.apply(c,a)}}}};f=function(a,c,d){var b= Object.create(j);b._context=a;b.uid=d;b.cluster=a.enhancements;Object.extend(b,b._pubsub());return Object.extend(b,c)};var k={collect:function(a){var c=this._Module,d,b;if(a)if(d=-1,b=a&&a.length?a.length:!1)for(;++d<b;)this.mods[++c.uid]=c.create(this,a[d],c.uid);else return this.mods[++c.uid]=c.create(this,a,c.uid),this},enhance:function(a){"object"===typeof a&&Object.extend(this.enhancements,a)},start:function(){for(var a in this.mods)"init"in this.mods[a]&&this.mods[a].init();return this}};e.Cluster= function(){var a=Object.create(k);a.mods={};a.enhancements={};Object.extend(a,{_Module:{create:f,uid:-1},_PubSub:g()});return a}})(window,document);
